<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>History | Red Tide Monitoring</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    body { margin: 0; font-family: Arial, sans-serif; background:url('underwaterpic.jpg') no-repeat center center/cover; }
    header { background: #004d40; color: white; padding: 15px; text-align: center; position: relative; }
    header .user-info { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); font-size: 14px; opacity: 0.9; }

    nav {
      background: #00796b;
      padding: 10px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
    }
    nav a { color: white; text-decoration: none; font-size: 16px; }
    nav a i { margin-right: 6px; }

    .content { padding: 20px; }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      overflow: hidden;
    }
    table th, table td {
      padding: 10px;
      text-align: center;
      border: 1px solid #ccc;
    }
    table th { background: #00796b; color: white; }
    table tr:nth-child(even) { background: #f9f9f9; }

    .badge {
      padding: 4px 8px;
      border-radius: 6px;
      color: white;
      font-size: 12px;
      font-weight: bold;
      display: inline-block;
      min-width: 65px;
    }
    .safe { background: #2e7d32; }
    .warning { background: #fbc02d; color: black; }
    .danger { background: #c62828; }

    .chart-container {
      margin-top: 20px;
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    @media (max-width: 768px) {
      nav a { font-size: 14px; }
      table { font-size: 14px; }
    }
  </style>
</head>
<body>
  <header>
    <h1><i class="fas fa-history"></i> Sensor History</h1>
    <div class="user-info" id="userEmail">Loading...</div>
  </header>
  <nav>
    <a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
    <a href="map.html"><i class="fas fa-map-marked-alt"></i> Map</a>
    <a href="history.html"><i class="fas fa-history"></i> History</a>
    <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </nav>

  <div class="content">
    <h2>ðŸ“Š Recorded Data</h2>
    <table id="historyTable">
      <thead>
        <tr>
          <th>Timestamp</th>
          <th>Temperature (Â°C)</th>
          <th>pH</th>
          <th>Turbidity (NTU)</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="chart-container">
      <canvas id="historyChart"></canvas>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAN6dv1k6wwqWT3pGn0jqUnjsGtevRh-iA",
      authDomain: "red-tide-monitoring-project.firebaseapp.com",
      databaseURL: "https://red-tide-monitoring-project-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "red-tide-monitoring-project",
      storageBucket: "red-tide-monitoring-project.firebasestorage.app",
      messagingSenderId: "39343588338",
      appId: "1:39343588338:web:991a6878a0aaee1651216b",
      measurementId: "G-QSVFVPPQM5"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById("userEmail").textContent = "Welcome, " + (user.displayName || user.email);
      } else {
        window.location.href = "main.html";
      }
    });

    function logout() {
      auth.signOut().then(() => window.location.href = "main.html");
    }

    const tableBody = document.querySelector("#historyTable tbody");

    const labels = [];
    const tempData = [];
    const phData = [];
    const turbData = [];

    const ctx = document.getElementById("historyChart").getContext("2d");
    const historyChart = new Chart(ctx, {
      type: "line",
      data: {
        labels: labels,
        datasets: [
          {
            label: "Temperature (Â°C)",
            data: tempData,
            borderColor: "red",
            backgroundColor: "rgba(255,0,0,0.2)",
            tension: 0.3
          },
          {
            label: "pH",
            data: phData,
            borderColor: "blue",
            backgroundColor: "rgba(0,255,0,0.2)",
            tension: 0.3
          },
          {
            label: "Turbidity (NTU)",
            data: turbData,
            borderColor: "green",
            backgroundColor: "rgba(0,0,255,0.2)",
            tension: 0.3
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: "top" },
          title: { display: true, text: "Sensor Data Trends" }
        
        }
      }
    });

    function getStatus(temp, ph, turb) {
      // Example rules â€“ adjust as needed
      if (temp > 35 || ph < 6.5 || ph > 8.5 || turb > 100) {
        return { text: "Danger", cls: "danger" };
      } else if (turb > 50 || temp > 30) {
        return { text: "Warning", cls: "warning" };
      } else {
        return { text: "Safe", cls: "safe" };
      }
    }

    db.ref("history").limitToLast(20).on("child_added", snapshot => {
  const entry = snapshot.val();
  const status = getStatus(entry.temperature, entry.ph, entry.turbidity);

  const timestamp = new Date(entry.timestamp).toLocaleString("en-PH", {
    timeZone: "Asia/Manila"
  });

  const timeLabel = new Date(entry.timestamp).toLocaleTimeString("en-PH", {
    timeZone: "Asia/Manila"
  });

  const row = document.createElement("tr");
  row.innerHTML = `
    <td>${timestamp}</td>
    <td>${entry.temperature.toFixed(2)}</td>
    <td>${entry.ph.toFixed(2)}</td>
    <td>${entry.turbidity.toFixed(2)}</td>
    <td><span class="badge ${status.cls}">${status.text}</span></td>
  `;
  tableBody.prepend(row);

  labels.push(timeLabel);
  tempData.push(entry.temperature);
  phData.push(entry.ph);
  turbData.push(entry.turbidity);

  if (labels.length > 20) {
    labels.shift();
    tempData.shift();
    phData.shift();
    turbData.shift();
  }
  historyChart.update();
});
  </script>
</body>
</html>







